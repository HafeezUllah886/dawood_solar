<?php
 namespace App\Http\Controllers; use App\Http\Controllers\Controller; use App\Models\categories; use App\Models\products; use App\Models\sale_details; use Illuminate\Http\Request; class productWiseSaleReportController extends Controller { public function index() { $products = products::all(); $categories = categories::all(); return view("\x72\145\x70\157\162\x74\x73\56\160\162\157\144\165\x63\164\137\x77\151\163\x65\x5f\x73\141\154\x65\137\162\145\160\157\x72\164\56\x69\156\x64\145\170", compact("\160\162\157\144\165\143\164\x73", "\x63\x61\x74\145\147\x6f\x72\151\145\163")); } public function data(Request $request) { $products = products::query(); $from = $request->from; $to = $request->to; if ($request->products) { $products->whereIn("\151\144", $request->products); } if ($request->categories) { $products->whereIn("\x63\x61\164\x49\x44", $request->categories); } $products = $products->get(); foreach ($products as $product) { $sales = sale_details::where("\x70\162\x6f\x64\165\143\x74\x49\x44", $product->id)->whereBetween("\144\x61\x74\x65", array($from, $to)); $product->sold = $sales->sum("\161\x74\171"); $product->amount = $sales->sum("\141\x6d\157\x75\x6e\x74"); if ($product->amount > 0) { $product->avg_price = $product->amount / $product->sold; } else { $product->avg_price = 0; } } return view("\x72\145\x70\157\162\164\x73\56\x70\162\157\x64\x75\x63\164\x5f\167\x69\x73\145\x5f\x73\141\154\145\137\162\x65\x70\x6f\x72\x74\56\144\145\x74\x61\151\154\163", compact("\160\x72\x6f\x64\x75\x63\x74\x73", "\146\162\157\155", "\164\x6f")); } }