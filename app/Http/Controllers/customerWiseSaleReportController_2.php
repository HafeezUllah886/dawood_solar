<?php
 namespace App\Http\Controllers; use App\Http\Controllers\Controller; use App\Models\accounts; use App\Models\sale_details; use App\Models\sales; use Illuminate\Http\Request; use Illuminate\Support\Facades\DB; class customerWiseSaleReportController_2 extends Controller { public function index() { $customers = accounts::customer()->get(); return view("\x72\145\x70\157\x72\x74\x73\56\143\x75\163\x74\x6f\x6d\145\x72\x5f\167\x69\x73\x65\137\x73\x61\154\145\x5f\162\x65\x70\x6f\162\164\x32\x2e\x69\156\144\145\170", compact("\143\x75\x73\164\x6f\x6d\145\162\x73")); } public function data(Request $request) { $from = $request->from; $to = $request->to; $customers = accounts::customer(); if ($request->customer) { $customers = $customers->whereIn("\x69\x64", $request->customer); } $customers = $customers->get(); $data = array(); foreach ($customers as $customer) { $sales = sales::where("\x63\x75\x73\x74\x6f\x6d\145\162\x49\104", $customer->id)->whereBetween("\144\x61\164\145", array($from, $to))->pluck("\x69\x64"); $saleDetails = sale_details::with("\x70\x72\x6f\144\x75\x63\x74")->whereIn("\163\x61\154\145\x73\x49\x44", $sales)->get(); $products = array(); foreach ($saleDetails as $product) { $productID = $product->productID; $productName = $product->product->name; $productCategory = $product->product->category->name; $productPrice = $product->price; $productQty = $product->qty; $productAmount = $product->amount; $productDate = $product->date; $products[] = array("\x6e\x61\155\x65" => $productName, "\x63\x61\x74\145\x67\157\x72\x79" => $productCategory, "\x73\x6f\x6c\x64\137\161\x74\171" => $productQty, "\164\x6f\164\141\154\x5f\141\x6d\x6f\165\x6e\x74" => $productAmount, "\x70\162\151\143\x65" => $productPrice, "\144\141\x74\145" => $productDate); } $customer->products = $products; $data[] = array("\143\x75\163\164\157\155\145\x72" => $customer, "\x70\162\157\144\165\143\164\163" => $products); } return view("\x72\145\x70\x6f\162\164\163\x2e\143\x75\x73\x74\x6f\x6d\145\162\137\167\151\x73\145\137\x73\141\x6c\x65\x5f\162\145\x70\x6f\162\164\62\56\x64\x65\x74\x61\x69\154\x73", compact("\144\x61\x74\x61", "\146\162\x6f\155", "\164\x6f")); } }