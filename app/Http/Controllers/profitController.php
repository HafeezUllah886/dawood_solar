<?php
 namespace App\Http\Controllers; use App\Models\expenses; use App\Models\products; use App\Models\sale_details; use App\Models\sales; use Illuminate\Http\Request; class profitController extends Controller { public function index() { return view("\162\x65\x70\157\x72\x74\x73\56\x70\162\x6f\x66\151\164\x2e\151\156\144\x65\170"); } public function data($from, $to) { $products = products::all(); $data = array(); foreach ($products as $product) { $purchaseRate = avgPurchasePrice($from, $to, $product->id); $saleRate = avgSalePrice($from, $to, $product->id); $sold = sale_details::where("\x70\x72\x6f\x64\x75\143\x74\111\x44", $product->id)->whereBetween("\x64\x61\164\x65", array($from, $to))->sum("\x71\x74\171"); $ppu = $saleRate - $purchaseRate; $profit = $ppu * $sold; $stock = getStock($product->id); $stockValue = productStockValue($product->id); $data[] = array("\x6e\x61\x6d\145" => $product->name, "\x70\x75\x72\143\150\141\x73\x65\122\141\164\x65" => $purchaseRate, "\163\141\154\145\122\141\164\145" => $saleRate, "\x73\x6f\x6c\x64" => $sold, "\x70\x70\x75" => $ppu, "\160\x72\157\x66\x69\x74" => $profit, "\x73\164\x6f\x63\153" => $stock, "\163\x74\x6f\x63\153\126\x61\x6c\165\145" => $stockValue); } $expenses = expenses::whereBetween("\x64\141\164\x65", array($from, $to))->sum("\141\x6d\157\x75\156\164"); $discounts = sales::whereBetween("\144\141\x74\145", array($from, $to))->sum("\x64\x69\x73\x63\x6f\x75\156\164"); return view("\x72\x65\x70\157\162\164\163\x2e\x70\x72\157\146\151\164\56\x64\145\x74\141\x69\x6c\x73", compact("\x66\x72\x6f\155", "\x74\x6f", "\x64\x61\x74\141", "\x65\170\160\x65\156\x73\145\x73", "\144\151\163\x63\157\165\x6e\x74\163")); } }